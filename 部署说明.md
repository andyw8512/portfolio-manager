# 持仓整理工具 - 公网部署说明

部署后可通过公网 URL 随处打开使用（如手机、公司电脑），无需在本机跑 `node server.js`。

---

## 一、部署前准备

1. **代码已就绪**：`server.js` 会同时提供接口和前端页面，并读取 `process.env.PORT`（云平台会自动注入）。
2. **API Key 建议**：公网环境不要用代码里的默认 Key，请在部署平台里配置**环境变量**：
   - `MINIMAX_API_KEY`、`MINIMAX_GROUP_ID`（可选）
   - `OPENAI_API_KEY`（若用 OpenAI）
   - `GEMINI_API_KEY`（若用 Gemini）
   
   配置后，把 `server.js` 里对应默认 Key 改成 `|| ''` 再部署，或直接不提交含 Key 的代码。

3. **Git 仓库**：将本项目推到 GitHub（或 GitLab），部署时用该仓库地址。

---

## 二、方式一：Railway 部署（推荐，有免费额度）

[Railway](https://railway.app) 支持 Node 一键部署，每月有免费额度。

### 步骤

1. **注册**：打开 <https://railway.app>，用 GitHub 登录。
2. **New Project** → **Deploy from GitHub repo**，选择你的仓库（需先把本项目推到 GitHub）。
3. **根目录与启动**：  
   - 若仓库根目录就是本项目（含 `server.js`、`package.json`），无需改。  
   - Railway 会识别 `package.json` 的 `"start": "node server.js"` 并执行，并自动设置 `PORT`。
4. **环境变量**：在项目 **Variables** 里添加：
   - `OPENAI_API_KEY` = 你的 OpenAI Key  
   - （可选）`MINIMAX_API_KEY`、`GEMINI_API_KEY` 等
5. **生成公网域名**：在 **Settings** → **Networking** → **Generate Domain**，得到类似 `xxx.up.railway.app`。
6. **访问**：浏览器打开 `https://xxx.up.railway.app` 即可使用（根路径即工具页面）。

### 注意

- 免费额度用完后需绑卡或升级；长时间无访问可能休眠，首次打开会稍慢。
- 若仓库里仍写有默认 Key，建议部署前改为仅用环境变量（见上文「部署前准备」）。

---

## 三、方式二：Render 部署

[Render](https://render.com) 也支持免费 Web 服务。

1. **注册**：<https://render.com>，用 GitHub 登录。
2. **New** → **Web Service**，连接 GitHub 仓库，选本项目。
3. **配置**：
   - **Build Command**：`npm install`（或留空，Render 会按 Node 项目执行）
   - **Start Command**：`node server.js` 或 `npm start`
   - **Instance Type**：选 Free（有休眠策略）
4. **Environment**：在 **Environment Variables** 里添加 `OPENAI_API_KEY` 等（同 Railway）。
5. **Deploy**：保存后自动构建并部署，会得到一个 `https://xxx.onrender.com` 的地址。
6. **访问**：打开该地址即可使用（根路径即工具页面）。

### 注意

- Free 实例一段时间无访问会休眠，再次打开可能需等待几十秒唤醒。

---

## 四、方式三：自有服务器 / VPS

若你有云主机（阿里云、腾讯云、海外 VPS 等）：

1. 在服务器上安装 Node.js（建议 18+）。
2. 把项目上传到服务器（git clone 或 scp）。
3. 在项目目录执行：
   ```bash
   npm install --production
   PORT=80 node server.js
   ```
   或使用 **pm2** 保活：
   ```bash
   npm i -g pm2
   PORT=80 pm2 start server.js --name portfolio-ocr
   pm2 save && pm2 startup
   ```
4. 用 Nginx 做反向代理并配置 HTTPS（可选）：将域名指向本机，代理到 `http://127.0.0.1:3011`（或你设置的 PORT）。
5. 环境变量在 shell 或 `.env` 中配置（见「部署前准备」）。

---

## 五、部署后使用方式

- **本机**：照旧可 `node server.js`，浏览器打开 `http://localhost:3011`。
- **公网**：浏览器打开部署得到的 URL（如 `https://xxx.up.railway.app`），无需登录，打开即用；数据仅在当前浏览器会话中，不经过你自建账号系统（若需登录可再自行加认证层）。

---

## 六、安全提醒

- 公网部署后，任何人拿到链接都能使用你的 OCR 额度（MiniMax/OpenAI/Gemini），建议**仅用环境变量配置 Key**，不要提交 Key 到代码库。
- 若希望仅自己用，可加一层简单鉴权（如密码或 Token），或使用平台提供的访问限制（如 Railway 的密码保护、Cloudflare Access 等）。
